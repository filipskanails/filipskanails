<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Дякуємо — Next Level</title>
  <meta name="color-scheme" content="dark">
  <style>
    :root{
      --bg:#0c100e; --card:#101411; --line:#233129;
      --text:#e7f0ea; --muted:#9fb3aa;
      --accent:#0b7d47; --accent-2:#004a25; --accent-rgb:11,125,71;
      --ok:#c7f5d2; --wait:#ffe3a3; --err:#ffb4b4;
      --ring: 0 0 0 4px rgba(11,125,71,.25);
    }
    *{box-sizing:border-box}
    html,body{
      margin:0; color:var(--text); background:
        radial-gradient(1200px 700px at 10% -10%, rgba(var(--accent-rgb),.22), transparent 50%),
        radial-gradient(900px 600px at 95% 10%, rgba(0,0,0,.22), transparent 50%),
        var(--bg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,sans-serif;
    }
    .wrap{max-width:960px;margin:0 auto;padding:32px 16px}
    .card{
      position:relative;
      background:linear-gradient(180deg, rgba(255,255,255,.035), transparent 60%), var(--card);
      border:1px solid var(--line); border-radius:20px; padding:22px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02), 0 12px 28px rgba(0,0,0,.28);
    }
    h1{margin:0 0 8px;font-size:30px;letter-spacing:.2px}
    h2{font-size:20px;margin:16px 0 8px}
    .muted{color:var(--muted)}

    /* badge */
    .badge{display:inline-flex;align-items:center;gap:8px;padding:7px 12px;border-radius:999px;font-weight:800}
    .badge.ok   {background:rgba(34,197,94,.12); color:var(--ok);  border:1px solid rgba(34,197,94,.35)}
    .badge.err  {background:rgba(239,68,68,.10); color:var(--err); border:1px solid rgba(239,68,68,.32)}
    .badge.wait {background:rgba(234,179,8,.08); color:var(--wait);border:1px solid rgba(234,179,8,.30)}
    .badge.plan {background:rgba(11,125,71,.10); color:#9fe7c3; border:1px solid rgba(11,125,71,.35)}
    .pulse{animation:pulse 1.4s ease-in-out infinite}
    @keyframes pulse { 0%,100%{ transform:translateZ(0) scale(1); } 50%{ transform:translateZ(0) scale(1.04); } }

    /* progress steps */
    .progress{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:14px 0 6px}
    .step{
      padding:14px;border-radius:14px;border:1px solid var(--line);
      background:rgba(255,255,255,.02); position:relative; overflow:hidden;
    }
    .step::after{
      content:""; position:absolute; inset:auto -40% -60% -40%; height:110px;
      background: radial-gradient(90px 40px at 50% 0, rgba(255,255,255,.04), transparent 60%);
      transform:rotate(-8deg);
    }
    .s-title{font-weight:800}
    .s-hint{color:var(--muted);font-size:13px;margin-top:4px}
    .chip{display:inline-block;margin-left:auto; float:right; padding:6px 8px; border-radius:8px;
      background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:#061f15; font-weight:900; font-size:12px}

    @media (max-width:800px){
      .progress{grid-template-columns:1fr 1fr}
    }
    @media (max-width:520px){
      .progress{grid-template-columns:1fr}
      .chip{float:none;margin-top:6px}
    }

    /* buttons */
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .cta{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:14px 20px;border-radius:999px;border:0; cursor:pointer;
      background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:#052116;
      font-weight:900; text-transform:uppercase; text-decoration:none;
      box-shadow: 0 10px 28px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.12);
      transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
    }
    .cta:hover{ transform: translateY(-1px); box-shadow: 0 12px 30px rgba(0,0,0,.33), var(--ring) }
    .cta:active{ transform: translateY(0) scale(.98) }
    .cta:disabled{ opacity:.6; cursor:not-allowed; filter:grayscale(.3) }

    .btn-secondary{
      background:#0f1713; color:var(--text); border:1px solid #2b4136; text-transform:none; font-weight:800;
    }
    .btn-ghost{
      background:transparent; color:var(--muted);
      border:1px dashed #2b4136; text-transform:none; font-weight:800;
    }

    .box{padding:14px;border:1px dashed var(--line);border-radius:14px;background:rgba(255,255,255,.02)}

    .note{font-size:14px;color:var(--muted);margin-top:8px}
    .kbd{padding:2px 8px;border-radius:6px;background:#0f1713;border:1px solid #27382f}

    /* pretty tip */
    .tip{
      display:flex;align-items:flex-start;gap:10px;margin-top:10px;padding:12px 14px;
      background:rgba(255,255,255,.02); border:1px solid var(--line); border-radius:12px;
    }
    .tip i{
      display:inline-flex;align-items:center;justify-content:center;
      width:22px;height:22px;border-radius:50%;
      background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:#052116; font-weight:900; font-style:normal;
    }

    /* confetti canvas (поки без анімації, просто для майбутнього) */
    #fx{position:fixed; inset:0; pointer-events:none}
    @media (prefers-reduced-motion: reduce){
      .pulse{animation:none}
      .cta{transition:none}
    }
  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <div class="wrap">
    <div class="card">
      <h1>
        Дякуємо за заявку
        <span class="badge wait pulse">Наступний крок — оплата</span>
      </h1>
      <p class="muted">
        Замовлення: <b id="ref">—</b> • План: <b id="planEcho">—</b>
      </p>

      <div class="progress">
        <div class="step">
          <span class="s-title">Заявка створена</span>
          <span class="chip">Done</span>
          <div class="s-hint">Ви вже заповнили форму на сайті.</div>
        </div>
        <div class="step">
          <span class="s-title">Перейти в Telegram-бота</span>
          <span class="chip">Telegram</span>
          <div class="s-hint">Натисніть кнопку нижче «Продовжити в Telegram-боті».</div>
        </div>
        <div class="step">
          <span class="s-title">Оплата за реквізитами</span>
          <span class="chip">Оплата</span>
          <div class="s-hint">У боті ви отримаєте номер картки та інструкцію.</div>
        </div>
        <div class="step">
          <span class="s-title">Доступ до курсу</span>
          <span class="chip">Доступ</span>
          <div class="s-hint">Після підтвердження оплати відкриється доступ до уроків.</div>
        </div>
      </div>

      <div class="box" style="margin-top:10px">
        <h2>Що далі?</h2>
        <div id="actions" class="row" style="margin-top:10px">
          <a id="goTg" class="cta" target="_blank" rel="noopener">Продовжити в Telegram-боті</a>
          <button id="copyLink" class="cta btn-ghost">Скопіювати посилання на бота</button>
        </div>
        <p class="note">
          У боті ви отримаєте реквізити для оплати, кнопку «Оплачено» та подальші інструкції.
          Після вашої оплати я перевірю платіж і відкрию доступ до курсу в тому ж боті.
        </p>
      </div>

      <div style="margin-top:16px">
        <div class="tip">
          <i>!</i>
          <div>
            <b>Якщо Telegram не відкривається автоматично</b><br>
            Скопіюйте це посилання та відкрийте його вручну:
            <span id="botLinkEcho" class="kbd"></span>
          </div>
        </div>

        <div class="row" style="margin-top:16px">
          <a id="toHome" class="cta btn-secondary" href="#">Повернутись на сайт</a>
        </div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const $ = s => document.querySelector(s);

    // ===== КОНФІГ =====
    const BOT_HANDLE = "NailSchoolFilipskabot";

    // ===== ПАРСИНГ ПАРАМЕТРІВ =====
    const params    = new URLSearchParams(location.search);
    const ref       = params.get('ref')  || "";
    const planRaw   = (params.get('plan') || "").toLowerCase(); // "group" | "individual"
    const homeParam = params.get('home') || "";

    $('#ref').textContent = ref || '—';

    const PLAN_LABELS = {
      group: 'Груповий',
      individual: 'Індивідуальний',
    };
    const planLabel = PLAN_LABELS[planRaw] || '';
    $('#planEcho').textContent = planLabel || '—';

    // ===== HOME (повернення на сайт) =====
    function normalizeHome(h){
      try{
        const u = new URL(h);
        return u.origin + u.pathname.replace(/\/?$/, '/');
      }catch{
        return null;
      }
    }
    const ALLOWED = new Set([
      "https://filipskanails.github.io/filipskanails/",
      "https://filipskanails.github.io/filipska-nails/",
    ]);
    let HOME = normalizeHome(homeParam);
    if(!HOME || !ALLOWED.has(HOME)){
      HOME = location.origin + location.pathname.replace(/thankyou\.html.*$/,'');
    }

    // ===== Telegram-лінк =====
    let botLink = "";
    if (BOT_HANDLE) {
      botLink = `https://t.me/${BOT_HANDLE}`;
      if (ref) botLink += `?start=${encodeURIComponent(ref)}`;
    }

    const goTg = $('#goTg');
    const botLinkEcho = $('#botLinkEcho');

    if (botLink && goTg) {
      goTg.href = botLink;
      if (botLinkEcho) botLinkEcho.textContent = botLink;
    } else {
      if (goTg) goTg.style.display = 'none';
      if (botLinkEcho) botLinkEcho.textContent = 'посилання тимчасово недоступне';
    }

    // Копіювання посилання
    const copyBtn = $('#copyLink');
    if (copyBtn && botLink) {
      copyBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        try{
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(botLink);
            copyBtn.textContent = "Скопійовано ✔";
            setTimeout(()=>{ copyBtn.textContent = "Скопіювати посилання на бота"; }, 2000);
          } else {
            prompt("Скопіюйте посилання вручну:", botLink);
          }
        }catch{
          prompt("Скопіюйте посилання вручну:", botLink);
        }
      });
    } else if (copyBtn) {
      copyBtn.style.display = 'none';
    }

    // Повернення на сайт
    $('#toHome').addEventListener('click', (e)=>{
      e.preventDefault();
      location.href = HOME + '#top';
    });
  })();
  </script>
</body>
</html>